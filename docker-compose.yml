version: '3'

services:
  master:
    build: ./jenkins-master/
    ports:
      - "50000:50000"
    volumes:
      - jenkins-data:/var/jenkins_home/
      - jenkins-log:/var/log/jenkins/
      - /usr/bin/docker:/usr/bin/docker
      - /usr/run/docker.sock:/usr/run/docker.sock
    networks:
      - jenkins-net

  nginx:
    build: ./jenkins-nginx/
    ports:
      - "8081:80"
    networks:
      - jenkins-net
  
  slave:
    build: ./jenkins-slave/
    networks:
      - jenkins-net

  proxy:
    build: ./docker-proxy/
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      jenkins-net:
        aliases:
          - proxy1


volumes:
  jenkins-data:
  jenkins-log:

networks:
  jenkins-net:
